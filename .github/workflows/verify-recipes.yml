name: Verify Recipes

on:
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]

jobs:
  build-latex:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Install LaTeX dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y texlive-latex-base texlive-latex-extra texlive-fonts-recommended

    - name: Compile Recipes
      run: |
        # Find all .tex files (excluding preamble.tex)
        find . -name "*.tex" ! -name "preamble.tex" -print0 | xargs -0 -n 1 bash -c '
          file="$1"
          dir=$(dirname "$file")
          base=$(basename "$file")
          echo "==========================================="
          echo "Compiling $base in $dir..."
          echo "==========================================="
          
          # Navigate to directory so \input{../preamble.tex} works correctly
          cd "$dir" || exit 1
          
          # Compile with pdflatex
          # -interaction=nonstopmode: don"t stop for user input
          # -halt-on-error: exit with error code if compilation fails
          pdflatex -interaction=nonstopmode -halt-on-error "$base"
        ' _
